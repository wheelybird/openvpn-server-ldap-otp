# PAM LDAP TOTP Configuration
#
# This file configures the PAM module for LDAP-backed TOTP authentication

# TOTP mode: append, challenge, web
# append - Concatenate TOTP to password (password123456)
# challenge - Server prompts for TOTP after password validation
# web - Use web authentication (requires TOTP_MODE=web_auth env var)
totp_mode append

# LDAP attribute containing the TOTP secret
# Options: totpSecret (recommended), userPassword, description
totp_attribute totpSecret

# LDAP attribute containing scratch/backup codes
scratch_attribute totpScratchCode

# LDAP attribute containing TOTP enrollment status (none, pending, active, disabled, bypassed)
status_attribute totpStatus

# LDAP attribute containing enrollment date (LDAP GeneralizedTime format: YYYYMMDDhhmmssZ)
enrolled_date_attribute totpEnrolledDate

# Prefix to identify TOTP data within the attribute
# Use "" for totpSecret, "{TOTP}" for userPassword, "TOTP-SECRET:" for description
totp_prefix ""

# Prefix for backup/scratch codes
scratch_prefix TOTP-SCRATCH:

# Allow fallback to file-based authenticator if LDAP is unavailable
# Files are read from /etc/openvpn/otp/${USER}.google_authenticator
fallback_to_file false

# TOTP time step in seconds (typically 30)
time_step 30

# Time window tolerance (number of steps to check before/after current time)
# window_size 3 means checking 3 steps back, current, and 3 steps forward
window_size 3

# Grace period for new users to set up MFA (days)
# Users with totpStatus=pending have this many days before enforcement
grace_period_days 7

# Enforcement mode: strict, graceful, warn_only
# strict - Block all access after grace period
# graceful - Block services but allow web UI for MFA setup
# warn_only - Show warnings but don't block (testing only)
enforcement_mode graceful

# Service DN allowed during MFA setup (bypasses enforcement)
# This allows users to log into the web UI to set up MFA
setup_service_dn cn=ldap-user-manager,ou=services,dc=example,dc=com

# Enable debug logging to syslog
debug false
